##os错题：

1. CS段寄存器中的最低两位保存的是CPL，DS段寄存器中的最低两位保存的是DPL

2. 可有效应对大地址空间可采用的页表手段是**多级页表**和**反置页表**

3. 页表项标志位包括**存在位，修改位，引用位和只读位**

4. 在使能分页机制的情况下，更合适的外碎片整理方法既不是紧凑也不是分区对换，因为分页方式不会有外碎片。

5. 重定位（紧缩过程修改地址），分段，分页，段页式均为内存管理。

6. 伙伴系统多个小空闲空间合并，过小的块无法被请求利用导致外碎片（本质是由于请求连续空间），块一半小于请求空间大小且块大于等于请求空间大小则分配导致类似分页机制的内部碎片。

7. 中断处理和子程序调用都需要压栈以保护现场。**中断处理一定会保存而子程序调用不需要保存其内容的是程序状态字寄存器（PSW）**。程序状态字（PSW）寄存器用于记录当前处理器的状态和控制指令的执行顺序，并且保留与运行程序相关的各种信息，主要作用是实现程序状态的保护和恢复。所以中断处理程序要将PSW保存，子程序调用在进程内部执行，不会更改PSW。

8. 中断向量地址是中断服务例程入口地址（入口等于地址，中断服务例程入口 = 中断服务例程地址 = 中断向量）。

9. 页目录表PDE的基址是保存在寄存器CR3中，是一个特殊的控制寄存器，二级页表结构。

10. 页表项虚拟，页帧物理。

11. 在启动页机制后，不可能进行的操作为取消段机制，只保留页机制（无法找到页）。

12. lab3虚存管理机制基于页映射机制，中断异常处理机制和IDE硬盘读写机制。即需要lab1的保护模式和段机制的建立、中断机制的建立和字符串输出，lab2完成了物理内存的建立、完成了物理内存空间分配和页表机制。

13. IDT中断描述符表（Interrupt Descriptor Table），产生中断（异常），硬件找中断号找到门Gate，其中同时有Offset和选择子，选择子作为Index查找GDT全局描述符表（段表）得到中断服务例程基址，基址和offset结合形成终端服务例程入口地址。

14. ```
    one.
    A引用值为2，建立A的软连接B，再建立A的硬链接C，然后删除A，此时引用计数值B = 1,C = 2。
    首次建立时B = 1，软连接除非再被硬链接，否则其自身不再改变，且被软连接的A也不增加计数值（A = 2）；C为A的硬链接，A+1 = 3 = C，然后删除A，C - 1 = 2。
    
    two.
    假设创建文件A，创建A的硬链接B,创建B的硬链接C,创建C的软链接D,删除文件A
    1.初始A = 1
    2.B lf A : A = B = 2
    3.C lf B : A = B = C = 3
    4.D lf-s C : A = B = C = 3, D = 1
    5.rm A : B = C = 2, D = 1
    
    总结：
    硬链接使所有以硬链接方式连接的文件引用计数+1
    软连接相当于创建新文件，与源文件和其硬链接的计数不相关
    ```

15. fork() 创建子进程中，会复制父进程的所有变量和内存，子进程的fork()返回0，父进程的fork()在创建子进程成功后，返回子进程标识符，**fork() 创建子进程中，会复制父进程的页表**

16. 锁的实现方法包含禁用中断，软件方式和原子操作指令；不包含添加硬件设备。

17. 中断禁用实现同步互斥只能支持单处理机环境，而原子操作支持多处理机中任意数量的进程同步。

18. PV操作原子性由操作系统保证。

19. 管程的主要特点有:局部数据变量只能被管程的过程访问，一个进程通过调用管程的一个过程进入管程，在任何时候，只能有一个进程在管程中执行。**但是会出现死锁（管程嵌套互锁）**

20. 管道(pipe)的实现通过内存文件（抽象文件）即可，不需要在磁盘文件系统中创建文件。

21. **进程间通信IPC：信号，管道，消息队列，共享内存。**

22. **死锁四个必要条件：互斥访问，持有并等待，非剥夺，循环等待**

23. 目录是一类特殊的文件，内容是文件索引表（<文件名, 指向文件的指针>)，可以通过硬链接和软连接实现文件别名。

24. 虚拟文件系统可以支持具体文件系统有：磁盘文件系统，设备文件系统，网络文件系统，系统状态文件系统。

25. 条带化和奇偶校验按“字节”或“位”：RAID-0/4/5基于数据块，RAID-3基于位。

26. RAID-0提高IO吞吐量，RAID-1提高IO可靠性和可用性。

27. 字符设备包括：鼠标键盘串口并口。

28. 设备管理子系统中，缓冲区的目的：缓和CPU与IO设备速度不匹配，减少对CPU的中断频率，放宽对CPU中断响应时间的限制，提高CPU与IO设备的并行性，**解决基本数据单元大小（即数据粒度）不匹配问题**

29. ucore信号量需要：处理器调度，屏蔽中断，等待队列，**动态内存不需要信号量**

30. ucore信号量被用于：条件变量实现，mm内存管理实现，哲学家问题实现，**中断机制支持了信号量的功能**

31. 轮询，设备中断，DMA是CPU与设备通信方式，**PIPE是进程间通信方式**

32. ucore管程和条件变量：管程采用信号量用于互斥操作和同步操作，也采用条件变量用于同步操作，属于管程的共享变量访问的函数需要互斥机制进行保护。

33. CR0：预定义标志，保护模式\实模式切换，协处理器等。

    CR1：未定义的控制寄存器，供将来的处理器使用

    CR2：页故障线性地址寄存器，保存最后一次出现页故障的全32位线性地址（即**页访问异常线性地址+控制位**）

    CR3：保存页表**物理地址**

34. CS：Code Segment，存放当前段基址，8086使用 `CS << 4 + IP(即PC)`

35. 中断和陷阱的主要区别：

    1 、trap通常由处理机正在执行的现行指令引起，而中断则是由与现行指令无关的中断源引起的。

    2 、trap处理程序提供的服务为当前进程所用，而中断处理程序提供的服务则不是为了当前进程的。

    3 、CPU 在执行完一条指令之后，下一条指令开始之前响应中断，而**在一条指令执行中也可以响应trap**

36. 预防死锁不可以通过摒弃互斥条件实现：互斥是资源固有特性，不能改变。

37. 启动外设-管态-由OS完成

38. 整个消息队列都是临界资源

39. 访管中断是由用户程序（软件）执行访管指令产生的一个中断，切换目态至管态，UNIX中为trap

40. 通道控制方式：通道执行通道程序（在内存中）完成IO

41. 顺序存取方法就是严格按照物理记录排列的顺序依次存取

42. 多级反馈队列既有抢占式又有非抢占式

43. UNIX系统中，不是所有进程都是由fork创建的（exec?)

44. 交换是将进程完整的调入内存，运行一段时间后再放回到磁盘上。虚拟存储器是使进程中的一部分在内存也能运行。两者换入换出的规模不同。覆盖技术在较小的可用内存中运行较大的程序，常用于多道程序系统，与**分区存储管理**配合使用，将程序划分为若干**功能相对独立**的模块，将**不会同时执行的**模块**共享同一块内存区域**，其中常用功能的代码和数据视为必要部分常驻内存中，而不常用功能则视为可选部分可放在其他程序模块中，指在需要用到时才装入内存。故交换并未实现虚拟存储器，虚拟技术也未实现虚拟存储器。**虚拟技术是结合了交换和覆盖的技术**

45. 操作系统的高级调度：作业调度；OS中必不可少的是：进程调度

46. Unix文件系统：索引文件；MS-DOS文件系统：链接文件

47. 程序顺序执行的特性：封闭性，顺序性，无关性

48. 链接文件不支持随机访问，故不不能直接存取

49. ## Belady现象 

    LRU和OPT属于一种栈算法 ，不产生belady异常  

    **产生****belady的算法：FIFO，CLOCK，改进CLOCK，不恢复计数的LFU。**   **重要！**

    **不产生****belady算法：OPT，LRU，恢复计数的LFU。**

    

    **FIFO产生belady异常的例子**

    > 序列：`123412512345`
    >
    > 物理页面数为3时缺页9次，物理页面数为4时缺页10次，可以看到页面增加，缺页次数反而增多，故属于belady异常。

    

    **CLOCK产生belady异常的例子**

    > 因如果所有页的访问位都为1时，clock算法将退化为FIFO，可以同样构造序列：`123412512345`
    >
    > 物理页面数为4时缺页10次，而物理页面数为3时缺页9次，页面增加，缺页次数反而增多，故属于belady异常。

    

    **不恢复计数的LFU产生belady的例子**

    > 序列：`00111220022313131........后面是3和1的循环`
    >
    > 物理页面数为2时，之后3和1循环不会出现任何缺页；而物理页数为3时，之后的3和1的循环总是缺页。
    >
    > 可以看到，物理页面增加了，缺页次数反而增加，故属于belady异常。

    

    **证明OPT和LRU不会产生belady异常**

    > 设有n个物理页页面数，记内存中的页面集合为S。若页面数增加1，则内存中的页面集合为S’
    >
    > - 对于OPT，S是最近n个**之后****即将要访问**的页面，S’是最近n+1个**之后**即将要访问的页面，集合S’包含集合S
    > - 对于LRU，S是最近n个**之前****已经访问**的页面，S’是最近n+1个**之前**已经访问的页面，集合S’包含集合S
    >
    > 所以S中命中的页，在S’中也一定命中，因而缺页率不会增加，因而不会产生belady异常。

    

50. 同进程内的线程不能互相抢占，用户线程分配的时间片平均较少，因此如果用户线程被阻塞，同进程的其他线程会不会阻塞

51. cache缺失分类（四类）：

    **强制缺失**：**第一次**访问相应的Cache块引起的缺失

    强制缺失无法避免

    **容量缺失**：在直接映射或组相联Cache的情况下，若该Cache行被替换出去时，**Cache已经满了**

    容量缺失可以增加Cache大小来避免。

    **冲突缺失**：在直接映射或组相联Cache的情况下，若该Cache行被替换出去时，**还有其他空闲的Cache行**

    冲突缺失可增加Cache相联度、优化替换策略、增大Cache大小

    **无效缺失**：其他进程修改了主存数据

52. 最坏内存匹配最容易产生内存碎片

53. 在分段存储管理系统中，用共享段表描述所有被共享的段。若进程 P1和 P2共享段S，则：

    内存中只存放一份代码的数据（段），此时共享段S在P1和P2中段号相互独立（每个进程都有自己的段表，段表中存储共享代码段的段号，此段号只需要建立到共享段的映射即可）

54. 内核级线程-操作系统视角看得到的线程（为每个内核线程创建一个TCB即线程控制块，而不是给每一个用户级线程建立），是处理机分配的基本单位。

55. 用户级线程的切换比内核级线程的切换效率高-**对**，内核级线程切换必须切换至核心态，而用户级线程调用库即可

56. 文件系统管理空闲磁盘块的数据结构是：位图，空闲磁盘块链，文件分配表（FAT）

57. 多任务操作系统具有**并发和并行**的特点，需要实现对共享资源的保护

58. **CLI**：Clear Interupt，屏蔽中断，intr_save，屏蔽外部中断

    **STI**：Set Interupt，使能中断，intr_restore，恢复外部中断

59. 区分信号量，条件变量，锁，管程

60. ```c
    // P唤醒Q
    // Hoare管程 : P等待Q继续，直到Q退出或等待；
    // Mesa管程 : Q等待P继续，直到P等待或退出；
    // Hansen管程 : 规定唤醒为管程中最后一个可执行的操作，两者折中,高效
    ```

61. 虚拟存储技术基于程序的局部性原理，如果一个应用程序的程序地址空间大于机器的物理内存空间，对于采用实存的操作系统无法将该程序全部装入内存，为克服实存管理的局限性，提出基于程序局部性原理的虚存管理思想。

62. 虚拟设备是指**把一个物理设备变换成多个对应的逻辑设备**，可供多个程序同时访问使用的计算机设备。

63. 用户程序对I/O设备的请求采用逻辑设备名，而在程序实际执行时使用物理设备名

64. 改进的CLOCK-淘汰页的次序（A访问位，M修改位）（A， M）取值：

    (0，0) -> (0, 1) -> (1, 0) -> (1, 1) ，即优先修改位换出再访问位换出。

65. 资源分配图中，process->resource为资源申请，resource->process为资源分配；无环路则无死锁，有环路可能死锁

66. 假定主存地址为 32 位，按字节编址，主存和 Cache 之间采用直接映射方式，主存块大小为 4 个字，每字 32 位，采用回写（Write Back）方式，则能存放 4K 字数据的 Cache 的总容量的位数至少是 ：**148K**：**每个块一个有效位，每个字一个脏位**

67. 临界资源：一次仅允许一个进程使用的共享资源；

    临界区：访问临界资源的那段代码

68. 管程与临界区不同的是，在管程中的线程可以临时放弃管程的互斥访问，让其他线程进入到管程中来。而临界区中的线程只能在线程退出临界区时，才可以放弃对临界区的访问。

69. 进程-资源图表达系统状态S为死锁状态的充分必要条件是：**资源分配图不可完全简化**

70. exec()调用后**进程ID以及PID**不变，但代码、堆栈、堆、数据都完全被重写。（**相同的进程，不同的程序**）

71. 如没有页机制的虚存管理，则无法实现采用Copy on Write机制的fork系统调用

72. 僵尸进程将会导致资源浪费，而孤儿进程则不会（孤儿进程被init进程回收）

73. **短进程优先平均周转时间最优**

74. 目录的内容是文件索引表<文件名, 指向文件的指针> 

75. **常见5种RAID类型对比**

    | **级别** | **特征** | **原理**                                   | **需要磁盘数** | **总可用空间** | **冗余** | **容错性** | **性能(与单块相比)** | **最多坏** |
    | -------- | -------- | ------------------------------------------ | -------------- | -------------- | -------- | ---------- | -------------------- | ---------- |
    | RAID0    | 条带     | 分片分散存入n块硬盘                        | n>=1           | n              | 否       | 无         | 读写速度n倍(最快)    | 0          |
    | RAID1    | 镜像     | 相同数据存入2n块硬盘                       | n>=2(偶数)     | n/2            | 是       | 有         | 写速度n/2倍读速度n倍 | 1          |
    | RAID4    | 校验     | 分片分散存入n-1块硬盘，校验码存入第n块硬盘 | n>=3           | n-1            | 是       | 有         | 读写速度(n-1)/n倍    | 1          |
    | RAID5    | 校验     | 分片和校验码混合存储                       | n>=3           | n-1            | 是       | 有         | 读写速度(n-1)/n倍    | 1          |
    | RAID6    | 校验     | 分片盘校验码盘分别2个数据分片校验码计算2次 | n>=4           | n-2            | 是       | 有         | 读写速度(n-1)/n倍    | 2          |

    > 注：若题目没有说RAID4和RAID5有几块，可认为有5个磁盘

76. **段表示访问方式和存储数据等属性相同的一段地址空间**

77. 工作集算法淘汰页面是在每一次访问页面的时候做这件事情，开销很大

    而缺页率置换算法的页面置换是在缺页中断的时候完成，开销更低。

    缺页率置换算法的物理页面数是在整个过程中动态调节的，更逼近工作集变化曲线。

78. 挂起：从内存转到外存

    <img src="/Users/mac/Library/Application Support/typora-user-images/image-20201216213917767.png" alt="image-20201216213917767" style="zoom:50%;" />

79. **fork() 创建子进程中，会复制父进程的页表**

80. 对于进程个数为n，资源类型为m的死锁检测算法的时间复杂度为：**$O(m*n^2)$**

81. 假定页目录起始物理地址是 0x1edc8000，并且物理地址 0x1edc8ff0 (=0x1edc8000+1020*4) 开始的页目录项是自映射项。

    则此处自映射项的内容是 `        | flags`，该自映射项的虚拟地址是`        `？ 

    > 页目录起始地址开始的4KB空间是页目录页表项的内容，
    >
    > 自映射项也就是那一个页目录项指向的页刚好是页目录表所在页，其内容也就是页目录表的起始地址。
    >
    > 由于页目录项（或页表项）高20位为下一级页表（或物理页表）的基址，后12为为标志位flags。
    >
    > 故自映射项的内容为： `0x1edc8 | flags`。
    >
    > 1020 = 1111111100  (2进制)
    >
    > 故自映射虚拟地址为：`1111111100`  `1111111100`  `1111111100`  `00` =  0xFF3FCFF0。

82. 在多处理机调度中，就绪任务队列的维护有两种策略： 

    单队列：使用无锁数据结构，维护一个全局队列 

    多队列：每个核有一个自己的局部队列 

    ①这两种方案相比，分别有什么好处和不足？（回答字数 150 字） 

    > 单队列：优点：各处理机的负载是均衡的；缺点：调度开销大
    >
    > 多队列：优点：调度开销小；缺点：各处理机可能忙闲不均

    

    ②提出一种新的改进方案，避免这两种方案各自的不足之处。（回答字数 150 字） 

    > 每个核有一个自己的局部队列，设一个全局处理的算法，定时轮询每个处理器，当有的处理器过忙可以将任务分配到其他相对不忙的处理器上运行。

83. 基于hoare机制的管程在执行条件变量的signal操作过程中，不会睡眠，而Mesa会

84. **连续分配**的特点：文件顺序读取性能（好），随机读取性能（好），（有）外碎片。

    **链式分配**的特点：（没有）外碎片，随机读取性能（坏），可靠性（差）。

    链式分配可靠性差是因为破坏一个链，后面的数据块就丢了。

    **索引分配**的特点：（没有）外碎片，随机访问性能（好），可靠性（好）。

85. **文件访问控制信息存放在文件描述符里，而不是文件分配表**

86. UNIX：超级块，索引节点，目录项，安装点

    ucore：超级块（第0个块），索引节点，目录项，文件，前三者作用范围整个OS，文件作用至某一具体进程

87. **动态分区分配策略**

    - 最先匹配First-fit    —  有外部碎片 ，分配大块时较慢 
    - 最佳匹配Best-fit   —  有外部碎片 ，释放分区较慢 ，容易产生很多无用的小碎片
    - 最差匹配Worst-fit  —  有外部碎片 ，释放分区较慢 ，**能避免**出现太多的小碎片 ，但容易破坏大的空闲分区

88. 物理内存探测：BIOS中断调用；直接探测

89. 安全状态一定没有死锁，不安全状态可能有死锁

90. proc_struct:

    trapframe：保存进程状态现场（被打断的执行上下文）

    context：保存与恢复进程/线程上下文

    进程系统调用或中断时，特权级切换导致切换栈，保存信息至trapframe但不修改context

91. 

